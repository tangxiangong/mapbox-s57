<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>S57 Map Debug</title>
    <script src='https://api.mapbox.gl.js/v3.0.1/mapbox-gl.js'></script>
    <link href='https://api.mapbox.gl.js/v3.0.1/mapbox-gl.css' rel='stylesheet' />
    <style>
        body { margin: 0; padding: 0; }
        #map { position: absolute; top: 0; bottom: 0; width: 100%; }
        #info { position: absolute; top: 10px; left: 10px; background: white; padding: 10px; border-radius: 5px; z-index: 1000; }
    </style>
</head>
<body>
    <div id="info">
        <div>Status: <span id="status">Initializing...</span></div>
        <div>Tiles loaded: <span id="tiles">0</span></div>
    </div>
    <div id="map"></div>

    <script>
        // Simple style without external file
        const style = {
            "version": 8,
            "name": "S-57 Chart Debug",
            "sources": {
                "s57-tiles": {
                    "type": "vector",
                    "tiles": ["http://localhost:8080/{z}/{x}/{y}.pbf"],
                    "maxzoom": 14
                }
            },
            "layers": [
                {
                    "id": "background",
                    "type": "background",
                    "paint": {
                        "background-color": "rgb(192, 213, 228)"
                    }
                },
                {
                    "id": "all-features",
                    "type": "circle",
                    "source": "s57-tiles",
                    "source-layer": "s57",
                    "paint": {
                        "circle-radius": 3,
                        "circle-color": "red"
                    }
                }
            ]
        };

        const map = new mapboxgl.Map({
            container: 'map',
            style: style,
            center: [111.708984, 21.698242],
            zoom: 11
        });

        let tilesLoaded = 0;
        const statusEl = document.getElementById('status');
        const tilesEl = document.getElementById('tiles');

        map.on('load', () => {
            statusEl.textContent = 'Map loaded';
            console.log('Map loaded successfully!');
        });

        map.on('error', (e) => {
            statusEl.textContent = 'Error: ' + e.error.message;
            console.error('Map error:', e);
        });

        map.on('sourcedata', (e) => {
            if (e.sourceId === 's57-tiles') {
                if (e.isSourceLoaded) {
                    statusEl.textContent = 'Source loaded';
                    console.log('S57 tiles source loaded');
                }
                if (e.tile) {
                    tilesLoaded++;
                    tilesEl.textContent = tilesLoaded;
                    console.log('Tile loaded:', e.tile.tileID);
                }
            }
        });

        map.on('data', (e) => {
            if (e.sourceDataType === 'metadata') {
                console.log('Source metadata loaded:', e.sourceId);
            }
        });

        // Add click handler to log coordinates
        map.on('click', (e) => {
            console.log('Clicked at:', e.lngLat);
        });
    </script>
</body>
</html> 